async function htmlWidget(e,t){const a=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,n=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function s(e){return e.split(",").reduce((e,t)=>(e[t]=!0,e),{})}const i=s("symbol,img,spacer"),o=s("bottom-align-content,center-align-content,top-align-content,layout-vertically,layout-horizontally,container-relative-shape,resizable,apply-filling-content-mode,apply-fitting-content-mode,center-align-image,left-align-image,right-align-image,center-align-text,left-align-text,right-align-text");function c(e){return!!i[e]}class l{constructor(e,t){this.name=e,this.attributes=this.getAttributes(t)}getAttributes(e){let t={};return e.replace(n,function(e,a){const r=Array.prototype.slice.call(arguments),n=r[2]?r[2]:r[3]?r[3]:r[4]?r[4]:function(e){return!!o[e]}(a)?a:"";t[a]=n.replace(/(^|[^\\])"/g,'$1\\"')}),t}}class g extends l{constructor(e,t){super(e,t)}}class d{constructor(e){this.name=e}}class m{constructor(e){this.text=e}}const u="Element",b="Text";function f(e,t){switch(e){case u:return function(e){const t=e.name,a=e.attributes;return e instanceof g?{type:u,tagName:t,attributes:a}:{type:u,tagName:t,attributes:a,children:[]}}(t);case b:return function(e){const t=e.text;return{type:b,content:t}}(t)}}function p(e){return function(e){let t={tag:"root",children:[]},a=[t];a.last=(()=>a[a.length-1]);for(let t=0;t<e.length;t++){const r=e[t];if(r instanceof l){const e=f(u,r);e.children?a.push(e):a.last().children.push(e)}else if(r instanceof d){let e=a[a.length-2],t=a.pop();e.children.push(t)}else r instanceof m&&a.last().children.push(f(b,r))}return t}(function(e){let t=e,n=[];const s=Date.now()+1e3;for(;t;){if(0===t.indexOf("\x3c!--")){const e=t.indexOf("--\x3e")+3;t=t.substring(e);continue}if(0===t.indexOf("</")){const e=t.match(r);if(!e)continue;t=t.substring(e[0].length);const a=e[1];if(c(a))continue;n.push(new d(a));continue}if(0===t.indexOf("<")){const e=t.match(a);if(!e)continue;t=t.substring(e[0].length);const r=e[1],s=e[2],i=c(r)?new g(r,s):new l(r,s);n.push(i);continue}const e=t.indexOf("<"),i=e<0?t:t.substring(0,e);if(t=e<0?"":t.substring(e),n.push(new m(i)),Date.now()>=s)break}return n}(e))}let $,h,k=-1,w=-1,y=-1,A=-1;console.log(p(e)),function e(t){let a;if(!t)throw new Error("widget Tag Must Be The Parent Tag");if("Text"==t.type)return;if("widget"==t.tagName&&!h){for(var r of(h="let widget = new ListWidget()",Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":E("widget","background-color",e,"widget");break;case"background-gradient":v("widget",e,"widget");break;case"background-image":F(e,"widget");break;case"refresh-after-date":case"spacing":O("widget",r,e,"widget");break;case"url":h+=`\nwidget.url = "${e.replace(/"/g,"")}"`;break;case"padding":I("widget",e,"widget");break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}for(var n of t.children)$="widget",e(n);return}if("stack"==t.tagName){for(var r of(h+=`\nlet stack${++k} = ${$}.addStack()`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":E("stack",r,e,"stack"+k);break;case"background-gradient":v("stack",e,"stack"+k);break;case"background-image":F(e,"widget");break;case"border-color":E("stack",r,e,"stack"+k);break;case"border-width":case"corner-radius":O("stack",r,e,"stack"+k);break;case"size":S("stack",r,e,"stack"+k);break;case"spacing":O("stack",r,e,"stack"+k);break;case"url":h+=`\nstack${k}.url = "${e.replace(/"/g,"")}"`;break;case"padding":I("stack",e,"stack"+k);break;case"bottom-align-content":h+=`\nstack${k}.bottomAlignContent()`;break;case"center-align-content":h+=`\nstack${k}.centerAlignContent()`;break;case"top-align-content":h+=`\nstack${k}.topAlignContent()`;break;case"layout-horizontally":h+=`\nstack${k}.layoutHorizontally()`;break;case"layout-vertically":h+=`\nstack${k}.layoutVertically()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}let a="stack"+k;for(var n of t.children)$=a,e(n);return}"symbol"==t.tagName&&(a=`SFSymbol.named("${t.attributes.named?t.attributes.named:"questionmark.circle"}").image`);if("img"==t.tagName||"symbol"==t.tagName){if(w++,a)h+=`\nlet image${w} = ${$}.addImage(${a})`;else{if(!t.attributes.src)throw new Error("img Element Must Have A src Attribute");if(t.attributes.src.trim().startsWith("data:image/")){let e=t.attributes.src.trim();e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),h+=`\nlet image${w} = ${$}.addImage(Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}")))`}else h+=`\nlet image${w} = ${$}.addImage(await new Request("${t.attributes.src.replace(/"/g,"")}").loadImage())`}for(var r of Object.keys(t.attributes)){let e=t.attributes[r].trim();if(e)switch(r){case"border-color":E("img",r,e,"image"+w);break;case"border-width":O("img",r,e,"image"+w);break;case"container-relative-shape":h+=`\nimage${w}.containerRelativeShape = true`;break;case"corner-radius":O("img",r,e,"image"+w);break;case"image-opacity":C("text",r,e,"text"+y);break;case"image-size":S("img",r,e,"image"+w);break;case"resizable":h+=`\nimage${w}.resizable = false`;break;case"tint-color":E("img",r,e,"image"+w);break;case"url":h+=`\nimage${w}.url = "${e.replace(/"/g,"")}"`;break;case"apply-filling-content-mode":h+=`\nimage${w}.applyFillingContentMode()`;break;case"apply-fitting-content-mode":h+=`\nimage${w}.applyFittingContentMode()`;break;case"center-align-image":h+=`\nimage${w}.centerAlignImage()`;break;case"left-align-image":h+=`\nimage${w}.leftAlignImage()`;break;case"right-align-image":h+=`\nimage${w}.rightAlignImage()`;break;case"named":case"src":break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("text"==t.tagName){y++;let e=[];for(var n of t.children)"Text"==n.type&&/[^\s]/.test(n.content)&&e.push(n.content);for(var r of(h+=`\nlet text${y} = ${$}.addText("${e.join(" ").replace(/"/g,"").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&")}")`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"font":if(!/^\s*[^,]+,\s*\d+\s*$/.test(e))throw new Error("font Attribute On text Element Must Have 1 font And 1 Positive Integer Separated By Commas");/^\s*(black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*\d+\s*$/.test(e)?h+=`\ntext${y}.font = Font.${e.replace(/^\s*(black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*(\d+)\s*$/,"$1$2($3)")}`:h+=`\ntext${y}.font = new Font("${e.split(",")[0].replace(/"/g,"")}",${e.split(",")[1].match(/\d+/g)[0]})`;break;case"line-limit":O("text",r,e,"text"+y);break;case"minimum-scale-factor":C("text",r,e,"text"+y);break;case"shadow-color":E("text",r,e,"text"+y);break;case"shadow-offset":if(!/^\s*-?\d+\s*,\s*-?\d+\s*$/.test(e))throw new Error("shadow-offset Attribute On text Element Must Have 2 Integers Separated By Commas");h+=`\ntext${y}.shadowOffset = new Point(${e.split(",")[0].match(/-?\d*/)[0]},${e.split(",")[1].match(/-?\d*/)[0]})`;break;case"shadow-radius":O("text",r,e,"text"+y);break;case"text-color":E("text",r,e,"text"+y);break;case"text-opacity":C("text",r,e,"text"+y);break;case"url":h+=`\ntext${y}.url = "${e.replace(/"/g,"")}"`;break;case"center-align-text":h+=`\ntext${y}.centerAlignText()`;break;case"left-align-text":h+=`\ntext${y}.leftAlignText()`;break;case"right-align-text":h+=`\ntext${y}.rightAlignText()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("spacer"==t.tagName)return void(h+=`\n${$}.addSpacer(${/\d+/.exec(t.attributes.space)?/\d+/.exec(t.attributes.space):""})`);throw"widget"==t.tagName?new Error("widget Element Must Not Be Nestled"):new Error("Invalid Tag Name:"+t.tagName)}(p(e).children.filter(e=>{if("widget"==e.tagName)return e})[0]),1==t&&console.log(h);let x=new(0,Object.getPrototypeOf(async function(){}).constructor)(h+"\nreturn widget");return await x();function E(e,t,a,r){if(!/^\s*#([a-fA-F0-9]{3,4}){1,2}(\s*,\s*#([a-fA-F0-9]{34}){1,2})?\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Be 1 Or 2 Hexes Separated By Commas`);let n=a.match(/#([a-fA-F0-9]{3,4}){2}|#([a-fA-F0-9]{3,4}){1}/g).map(e=>{let t;return 5==e.length?(t=parseInt(e[4]+e[4],16),e=e.slice(0,-1)):9==e.length?(t=parseInt(e[5]+e[6],16),e=e.slice(0,-2)):t=255,[e,t/255]});h+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${2==n.length?`Color.dynamic(new Color("${n[0][0]}",${n[0][1]}),new Color("${n[1][0]}",${n[1][1]}))`:`new Color("${n[0][0]}",${n[0][1]})`}`}function O(e,t,a,r){if(!/^\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer`);h+="refresh-after-date"==t?`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${/\d+/.exec(a)})\nwidget.refreshAfterDate = date`:`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${/\d+/.exec(a)}`}function C(e,t,a,r){if(!/^\s*\d*(?:\.\d*)?%?\s*$/.test(a)&&"."!==/^\s*\d*(?:\.\d*)?%?\s*$/.exec(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer Or Float With An Optional  "%" At The End`);(a=/\d*(?:\.\d*)?%?/.exec(a)[0]).endsWith("%")&&(a=Number(a.replace("%","")),a/=100),h+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${a}`}function v(e,t,a){if(!/(,|^)\s*\(\s*#([a-fA-F0-9]{3,4}){1,2}\s*,\s*#([a-fA-F0-9]{3,4}){1,2}\)|(,|^)\s*#([a-fA-F0-9]{3,4}){1,2}/g.test(t))throw new Error(`background-gradient Attribute On ${e} Element Must Be 1 Or More Hexes Or Hexes Separated By Commas And In Brackets Separated By Commas`);let r=t.match(/(,|^)\s*\(\s*#([a-fA-F0-9]{3,4}){1,2}\s*,\s*#([a-fA-F0-9]{3,4}){1,2}\)|(,|^)\s*#([a-fA-F0-9]{3,4}){1,2}/g).map(e=>(e=e.match(/#([a-fA-F0-9]{3,4}){1,2}/g).map(e=>{let t;return 5==e.length?(t=parseInt(e[4]+e[4],16),e=e.slice(0,-1)):9==e.length?(t=parseInt(e[5]+e[6],16),e=e.slice(0,-2)):t=255,[e,t/255]}),console.log(e),e=2==e.length?`Color.dynamic(new Color("${e[0][0]}",${e[0][1]}),new Color("${e[1][0]}",${e[1][1]}))`:`new Color("${e[0][0]}",${e[0][1]})`)),n=[];for(let e=0,t=r.length;e<t;e++)n.push(e/(t-1));h+=`\nlet gradient${++A} = new LinearGradient()\ngradient${A}.colors = [${r}]\ngradient${A}.locations= [${n}]\n${a}.backgroundGradient = gradient${A}`}function I(e,t,a){if(!/^\s*\d+((\s*,\s*\d+){3}|(\s*,\s*\d+))?\s*$/g.test(t))throw new Error(`padding Attribute On ${e} Element Must Be 1, 2 Or 4 Positive Integers Separated By Commas`);paddingArray=t.match(/\d+/g),1==paddingArray.length?paddingArray=[paddingArray[0],paddingArray[0],paddingArray[0],paddingArray[0]]:2==paddingArray.length&&(paddingArray=[paddingArray[0],paddingArray[1],paddingArray[0],paddingArray[1]]),h+=`\n${a}.setPadding(${paddingArray.join(",")})`}function F(e,t){e.startsWith("data:image/")?(e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),h+=`\n${t}.backgroundImage = Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}"))`):h+=`\n${t}.backgroundImage = await new Request("${e.replace(/"/g,"")}").loadImage()`}function S(e,t,a,r){if(!/^\s*\d+\s*,\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Have 2 Positive Integers Separated By Commas`);h+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = new Size(${a.match(/\d+/g)[0]},${a.match(/\d+/g)[1]})`}}
