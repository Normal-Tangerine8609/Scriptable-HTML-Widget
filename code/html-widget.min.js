async function htmlWidget(e,t){const a=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,n=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function i(e){return e.split(",").reduce((e,t)=>(e[t]=!0,e),{})}const o=i("symbol,img,spacer,hr"),s=i("bottom-align-content,center-align-content,top-align-content,layout-vertically,layout-horizontally,container-relative-shape,resizable,apply-filling-content-mode,apply-fitting-content-mode,center-align-image,left-align-image,right-align-image,center-align-text,left-align-text,right-align-text,apply-date-style,apply-offset-style,apply-relative-style,apply-timer-style,apply-time-style");function c(e){return!!o[e]}class l{constructor(e,t){this.name=e,this.attributes=this.getAttributes(t)}getAttributes(e){let t={};return e.replace(n,function(e,a){const r=Array.prototype.slice.call(arguments),n=r[2]?r[2]:r[3]?r[3]:r[4]?r[4]:function(e){return!!s[e]}(a)?a:"";t[a]=n.replace(/(^|[^\\])"/g,'$1\\"')}),t}}class g extends l{constructor(e,t){super(e,t)}}class d{constructor(e){this.name=e}}class u{constructor(e){this.text=e}}const m="Element",b="Text";function p(e,t){switch(e){case m:return function(e){const t=e.name,a=e.attributes;return e instanceof g?{type:m,tagName:t,attributes:a}:{type:m,tagName:t,attributes:a,children:[]}}(t);case b:return function(e){const t=e.text;return{type:b,content:t}}(t)}}let f,w,h=-1,$=-1,k=-1,y=-1,A=-1,x=-1;var v;await async function e(t){let a;if(!t)throw new Error("widget Tag Must Be The Parent Tag");if("Text"==t.type)return;if("widget"==t.tagName&&!w){for(var r of(w="let widget = new ListWidget()",Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":await O("widget","background-color",e,"widget");break;case"background-gradient":await P("widget",e,"widget");break;case"background-image":N(e,"widget");break;case"refresh-after-date":case"spacing":C("widget",r,e,"widget");break;case"url":w+=`\nwidget.url = "${e.replace(/"/g,"")}"`;break;case"padding":z("widget",e,"widget");break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}for(var n of t.children)f="widget",await e(n);return}if("stack"==t.tagName){for(var r of(w+=`\nlet stack${++h} = ${f}.addStack()`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":await O("stack",r,e,"stack"+h);break;case"background-gradient":await P("stack",e,"stack"+h);break;case"background-image":N(e,"widget");break;case"border-color":await O("stack",r,e,"stack"+h);break;case"border-width":case"corner-radius":C("stack",r,e,"stack"+h);break;case"size":T("stack",r,e,"stack"+h);break;case"spacing":C("stack",r,e,"stack"+h);break;case"url":w+=`\nstack${h}.url = "${e.replace(/"/g,"")}"`;break;case"padding":z("stack",e,"stack"+h);break;case"bottom-align-content":w+=`\nstack${h}.bottomAlignContent()`;break;case"center-align-content":w+=`\nstack${h}.centerAlignContent()`;break;case"top-align-content":w+=`\nstack${h}.topAlignContent()`;break;case"layout-horizontally":w+=`\nstack${h}.layoutHorizontally()`;break;case"layout-vertically":w+=`\nstack${h}.layoutVertically()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}let a="stack"+h;for(var n of t.children)f=a,e(n);return}"symbol"==t.tagName&&(a=`SFSymbol.named("${t.attributes.named?t.attributes.named:"questionmark.circle"}").image`);if("img"==t.tagName||"symbol"==t.tagName){if($++,a)w+=`\nlet image${$} = ${f}.addImage(${a})`;else{if(!t.attributes.src)throw new Error("img Element Must Have A src Attribute");if(t.attributes.src.trim().startsWith("data:image/")){let e=t.attributes.src.trim();e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),w+=`\nlet image${$} = ${f}.addImage(Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}")))`}else w+=`\nlet image${$} = ${f}.addImage(await new Request("${t.attributes.src.replace(/"/g,"")}").loadImage())`}for(var r of Object.keys(t.attributes)){let e=t.attributes[r].trim();if(e)switch(r){case"border-color":await O("img",r,e,"image"+$);break;case"border-width":C("img",r,e,"image"+$);break;case"container-relative-shape":w+=`\nimage${$}.containerRelativeShape = true`;break;case"corner-radius":C("img",r,e,"image"+$);break;case"image-opacity":I("text",r,e,"text"+k);break;case"image-size":T("img",r,e,"image"+$);break;case"resizable":w+=`\nimage${$}.resizable = false`;break;case"tint-color":await O("img",r,e,"image"+$);break;case"url":w+=`\nimage${$}.url = "${e.replace(/"/g,"")}"`;break;case"apply-filling-content-mode":w+=`\nimage${$}.applyFillingContentMode()`;break;case"apply-fitting-content-mode":w+=`\nimage${$}.applyFittingContentMode()`;break;case"center-align-image":w+=`\nimage${$}.centerAlignImage()`;break;case"left-align-image":w+=`\nimage${$}.leftAlignImage()`;break;case"right-align-image":w+=`\nimage${$}.rightAlignImage()`;break;case"named":case"src":break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("text"==t.tagName){k++;let e=[];for(var n of t.children)"Text"==n.type&&e.push(n.content.trim());for(var r of(w+=`\nlet text${k} = ${f}.addText("${e.join(" ").replace(/"/g,"").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&").replace(/\n\s+/g,"\\n")}")`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"font":B("text",e,"text"+k);break;case"line-limit":C("text",r,e,"text"+k);break;case"minimum-scale-factor":I("text",r,e,"text"+k);break;case"shadow-color":await O("text",r,e,"text"+k);break;case"shadow-offset":M("text",e,"text"+k);break;case"shadow-radius":C("text",r,e,"text"+k);break;case"text-color":await O("text",r,e,"text"+k);break;case"text-opacity":I("text",r,e,"text"+k);break;case"url":w+=`\ntext${k}.url = "${e.replace(/"/g,"")}"`;break;case"center-align-text":w+=`\ntext${k}.centerAlignText()`;break;case"left-align-text":w+=`\ntext${k}.leftAlignText()`;break;case"right-align-text":w+=`\ntext${k}.rightAlignText()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("date"==t.tagName){A++;let e=[];for(var n of t.children)"Text"==n.type&&e.push(n.content.trim());for(var r of(w+=`\nlet date${A} = ${f}.addDate(new Date("${e.join("").replace(/"/g,"").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&").replace(/\n\s+/g,"\\n").replace(/"/g,"")}"))`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"font":B("date",e,"date"+A);break;case"line-limit":C("date",r,e,"date"+A);break;case"minimum-scale-factor":I("date",r,e,"date"+A);break;case"shadow-color":await O("date",r,e,"date"+A);break;case"shadow-offset":M("date",e,"date"+A);break;case"shadow-radius":C("date",r,e,"date"+A);break;case"text-color":await O("date",r,e,"date"+A);break;case"text-opacity":I("date",r,e,"date"+A);break;case"url":w+=`\ndate${A}.url = "${e.replace(/"/g,"")}"`;break;case"center-align-text":w+=`\ndate${A}.centerAlignText()`;break;case"left-align-text":w+=`\ndate${A}.leftAlignText()`;break;case"right-align-text":w+=`\ndate${A}.rightAlignText()`;break;case"apply-date-style":w+=`\ndate${A}.applyDateStyle()`;break;case"apply-offset-style":w+=`\ndate${A}.applyOffsetStyle()`;break;case"apply-relative-style":w+=`\ndate${A}.applyRelativeStyle()`;break;case"apply-timer-style":w+=`\ndate${A}.applyTimerStyle()`;break;case"apply-time-style":w+=`\ndate${A}.applyTimeStyle()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("hr"==t.tagName){x++;let e=t.attributes.width||"1";if(!/^\s*\d+\s*$/.test(e))throw new Error("width Attribute On hr Element Must Be A Positive Integer");for(var r of(w+=`\nlet hr${x} = ${f}.addStack()\nhr${x}.addSpacer()\nlet hrImage${x} = hr${x}.addImage(Image.fromData(Data.fromBase64String("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")))\nhrImage${x}.imageSize = new Size(1,${e})\nhr${x}.addSpacer()`,t.attributes["background-color"]||t.attributes["background-gradient"]||(w+=`\nhr${x}.backgroundColor = Color.dynamic(Color.black(), Color.white())`),Object.keys(t.attributes))){let a=t.attributes[r].trim();if(a)switch(r){case"background-color":await O("hr",r,a,"hr"+x);break;case"background-gradient":P("hr",a,"hr"+x);break;case"corner-radius":C("hr",r,a,"hr"+x);break;case"url":w+=`\nhr${x}.url = "${a.replace(/"/g,"")}"`;break;case"layout-horizontally":w+=`\nhr${x}.layoutHorizontally()\nhrImage${x}.imageSize = new Size(1,${e})`;break;case"layout-vertically":w+=`\nhr${x}.layoutVertically()\nhrImage${x}.imageSize = new Size(${e},1)`;break;case"width":break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("spacer"==t.tagName)return void(w+=`\n${f}.addSpacer(${/\d+/.exec(t.attributes.space)?/\d+/.exec(t.attributes.space):""})`);throw"widget"==t.tagName?new Error("widget Element Must Not Be Nestled"):new Error("Invalid Tag Name:"+t.tagName)}((v=e,function(e){let t={tag:"root",children:[]},a=[t];a.last=(()=>a[a.length-1]);for(let t=0;t<e.length;t++){const r=e[t];if(r instanceof l){const e=p(m,r);e.children?a.push(e):a.last().children.push(e)}else if(r instanceof d){let e=a[a.length-2],t=a.pop();e.children.push(t)}else r instanceof u&&a.last().children.push(p(b,r))}return t}(function(e){let t=e,n=[];const i=Date.now()+1e3;for(;t;){if(0===t.indexOf("\x3c!--")){const e=t.indexOf("--\x3e")+3;t=t.substring(e);continue}if(0===t.indexOf("</")){const e=t.match(r);if(!e)continue;t=t.substring(e[0].length);const a=e[1];if(c(a))continue;n.push(new d(a));continue}if(0===t.indexOf("<")){const e=t.match(a);if(!e)continue;t=t.substring(e[0].length);const r=e[1],i=e[2],o=c(r)?new g(r,i):new l(r,i);n.push(o);continue}const e=t.indexOf("<"),o=e<0?t:t.substring(0,e);if(t=e<0?"":t.substring(e),n.push(new u(o)),Date.now()>=i)break}return n}(v))).children.filter(e=>{if("widget"==e.tagName)return e})[0]),1==t&&console.log(w);let S=new(0,Object.getPrototypeOf(async function(){}).constructor)(w+"\nreturn widget");return await S();async function E(e){let t=new WebView;return await t.loadHTML(`<div id="div"style="color:${e}"></div>`),function(e,t,a,r){e=e.toString(16),t=t.toString(16),a=a.toString(16),1==e.length&&(e="0"+e);1==t.length&&(t="0"+t);1==a.length&&(a="0"+a);r=r?1==r.length?",0"+r:","+r:"";return`new Color("${"#"+e+t+a}"${r})`}(...(await t.evaluateJavaScript('window.getComputedStyle(document.getElementById("div")).color')).match(/\d+(\.\d+)?/g).map(e=>Number(e)))}async function O(e,t,a,r){colours=a.split("-"),w+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${2==colours.length?"Color.dynamic("+await E(colours[0])+","+await E(colours[1])+")":await E(colours[0])}`}function C(e,t,a,r){if(!/^\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer`);w+="refresh-after-date"==t?`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${/\d+/.exec(a)})\nwidget.refreshAfterDate = date`:`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${/\d+/.exec(a)}`}function I(e,t,a,r){if(!/^\s*\d*(?:\.\d*)?%?\s*$/.test(a)&&"."!==/^\s*\d*(?:\.\d*)?%?\s*$/.exec(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer Or Float With An Optional  "%" At The End`);(a=/\d*(?:\.\d*)?%?/.exec(a)[0]).endsWith("%")&&(a=Number(a.replace("%","")),a/=100),w+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${a}`}async function P(e,t,a){t=t.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).map(e=>e.trim());let r=/^(to bottom left|to bottom right|to top left|to top right|to top|to bottom|to right|to left)/,n="to bottom";r.test(t[0])&&(n=t.shift().match(r)[1]),n={"to left":["new Point(1, 0)","new Point(0, 0)"],"to right":["new Point(0, 1)","new Point(1, 1)"],"to top":["new Point(1, 1)","new Point(1, 0)"],"to bottom":["new Point(0, 0)","new Point(0, 1)"],"to top left":["new Point(1, 1)","new Point(0, 0)"],"to top right":["new Point(0, 1)","new Point(1, 0)"],"to bottom left":["new Point(1, 0)","new Point(0, 1)"],"to bottom right":["new Point(0, 0)","new Point(1, 1)"]}[n];let i=[];for(var o of t)o=o.split("-"),i.push(2==o.length?"Color.dynamic("+await E(o[0])+","+await E(o[1])+")":await E(o[0]));let s=[];for(let e=0,t=i.length;e<t;e++)s.push(e/(t-1));w+=`\nlet gradient${++y} = new LinearGradient()\ngradient${y}.colors = [${i}]\ngradient${y}.locations= [${s}]\ngradient${y}.startPoint = ${n[0]}\ngradient${y}.endPoint = ${n[1]}\n${a}.backgroundGradient = gradient${y}`}function z(e,t,a){if(!/^\s*\d+((\s*,\s*\d+){3}|(\s*,\s*\d+))?\s*$/g.test(t))throw new Error(`padding Attribute On ${e} Element Must Be 1, 2 Or 4 Positive Integers Separated By Commas`);paddingArray=t.match(/\d+/g),1==paddingArray.length?paddingArray=[paddingArray[0],paddingArray[0],paddingArray[0],paddingArray[0]]:2==paddingArray.length&&(paddingArray=[paddingArray[0],paddingArray[1],paddingArray[0],paddingArray[1]]),w+=`\n${a}.setPadding(${paddingArray.join(",")})`}function N(e,t){e.startsWith("data:image/")?(e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),w+=`\n${t}.backgroundImage = Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}"))`):w+=`\n${t}.backgroundImage = await new Request("${e.replace(/"/g,"")}").loadImage()`}function T(e,t,a,r){if(!/^\s*\d+\s*,\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Have 2 Positive Integers Separated By Commas`);w+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = new Size(${a.match(/\d+/g)[0]},${a.match(/\d+/g)[1]})`}function B(e,t,a){if(!/^\s*[^,]+,\s*\d+\s*$/.test(t))throw new Error(`font Attribute On ${e} Element Must Have 1 font And 1 Positive Integer Separated By Commas`);/^\s*(black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*\d+\s*$/.test(t)?w+=`\n${a}.font = Font.${t.replace(/^\s*(black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*(\d+)\s*$/,"$1$2($3)")}`:w+=`\n${a}.font = new Font("${t.split(",")[0].replace(/"/g,"")}",${t.split(",")[1].match(/\d+/g)[0]})`}function M(e,t,a){if(!/^\s*-?\d+\s*,\s*-?\d+\s*$/.test(t))throw new Error(`shadow-offset Attribute On ${e} Element Must Have 2 Integers Separated By Commas`);w+=`\n${a}.shadowOffset = new Point(${t.split(",")[0].match(/-?\d*/)[0]},${t.split(",")[1].match(/-?\d*/)[0]})`}}
