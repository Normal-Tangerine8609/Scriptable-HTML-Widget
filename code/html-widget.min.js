async function htmlWidget(e,t){const a=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,n=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function i(e){return e.split(",").reduce((e,t)=>(e[t]=!0,e),{})}const o=i("symbol,img,spacer"),s=i("bottom-align-content,center-align-content,top-align-content,layout-vertically,layout-horizontally,container-relative-shape,resizable,apply-filling-content-mode,apply-fitting-content-mode,center-align-image,left-align-image,right-align-image,center-align-text,left-align-text,right-align-text");function l(e){return!!o[e]}class c{constructor(e,t){this.name=e,this.attributes=this.getAttributes(t)}getAttributes(e){let t={};return e.replace(n,function(e,a){const r=Array.prototype.slice.call(arguments),n=r[2]?r[2]:r[3]?r[3]:r[4]?r[4]:function(e){return!!s[e]}(a)?a:"";t[a]=n.replace(/(^|[^\\])"/g,'$1\\"')}),t}}class g extends c{constructor(e,t){super(e,t)}}class u{constructor(e){this.name=e}}class m{constructor(e){this.text=e}}const d="Element",p="Text";function b(e,t){switch(e){case d:return function(e){const t=e.name,a=e.attributes;return e instanceof g?{type:d,tagName:t,attributes:a}:{type:d,tagName:t,attributes:a,children:[]}}(t);case p:return function(e){const t=e.text;return{type:p,content:t}}(t)}}String.prototype.replaceQuotes=function(){return this.replace(/"/g,"")},String.prototype.getNumber=function(){return this.match(/\d/g)?this.match(/\d/g).join(""):0};let $,f,h=-1,w=-1,k=-1,C=-1;var y;!function e(t){let a;if(!t)throw new Error("widget Tag Must Be The Parent Tag");if("Text"==t.type)return;if("widget"==t.tagName&&!f){for(var r of(f="let widget = new ListWidget()",Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":1!=e.split(",").length?f+=`\nwidget.backgroundColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nwidget.backgroundColor = new Color("${e.replaceQuotes()}")`;break;case"background-gradient":let a=e.match(/(,|^)\s*\(\s*#([a-fA-F0-9]{3}){1,2}\s*,\s*#[a-fA-F0-9]{3,6}\)|(,|^)\s*#([a-fA-F0-9]{3}){1,2}/g).map(e=>e=2==(e=e.match(/#([a-fA-F0-9]{3}){1,2}/g)).length?`Color.dynamic(new Color("${e[0]}"),new Color("${e[1]}"))`:`new Color("${e[0]}")`),n=[];for(let e=0,t=a.length;e<t;e++)n.push(e/(t-1));f+=`\nlet gradient${++C} = new LinearGradient()\ngradient${C}.colors = [${a}]\ngradient${C}.locations= [${n}]\nwidget.backgroundGradient = gradient${C}`;break;case"background-image":e.startsWith("data:image/")?(e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),f+=`\nwidget.backgroundImage = Image.fromData(Data.fromBase64String("${base.replaceQuotes()}"))`):f+=`\nwidget.backgroundImage = await new Request("${e.replaceQuotes()}").loadImage()`;break;case"refresh-after-date":f+=`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${e.getNumber()})\nwidget.refreshAfterDate = date`;break;case"spacing":f+=`\nwidget.spacing = ${e.getNumber()}`;break;case"url":f+=`\nwidget.url = "${e.replaceQuotes()}"`;break;case"padding":let i=e.split(",").map(function(e){return e.trim().getNumber()});if(1==i.length)i=[i[0],i[0],i[0],i[0]];else if(2==i.length)i=[i[0],i[1],i[0],i[1]];else if(4!=i.length)throw new Error("padding Attribute On widget Must Have 1, 2 Or 4 Parameters");f+=`\nwidget.setPadding(${i.join(",")})`;break;default:throw new Error(`Unknown Attribute ${r} On Tag ${t.tagName}`)}}for(var n of t.children)$="widget",e(n);return}if("stack"==t.tagName){for(var r of(f+=`\nlet stack${++h} = ${$}.addStack()`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":1!=e.split(",").length?f+=`\nstack${h}.backgroundColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nstack${h}.backgroundColor = new Color("${e.replaceQuotes()}")`;break;case"background-gradient":let a=e.match(/(,|^)\s*\(\s*#([a-fA-F0-9]{3}){1,2}\s*,\s*#[a-fA-F0-9]{3,6}\)|(,|^)\s*#([a-fA-F0-9]{3}){1,2}/g).map(e=>e=2==(e=e.match(/#([a-fA-F0-9]{3}){1,2}/g)).length?`Color.dynamic(new Color("${e[0]}"),new Color("${e[1]}"))`:`new Color("${e[0]}")`),n=[];for(let e=0,t=a.length;e<t;e++)n.push(e/(t-1));f+=`\nlet gradient${++C} = new LinearGradient()\ngradient${C}.colors = [${a}]\ngradient${C}.locations= [${n}]\nstack${h}.backgroundGradient = gradient${C}`;break;case"background-image":e.startsWith("data:image/")?(e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),f+=`\nwidget.backgroundImage = Image.fromData(Data.fromBase64String("${base.replaceQuotes()}"))`):f+=`\nwidget.backgroundImage = await new Request("${e.replaceQuotes()}").loadImage()`;break;case"border-color":1!=e.split(",").length?f+=`\nstack${h}.borderColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nstack${h}.borderColor = new Color("${e.replaceQuotes()}")`;break;case"border-width":f+=`\nstack${h}.borderWidth = ${e.getNumber()}`;break;case"corner-radius":f+=`\nstack${h}.cornerRadius = ${e.getNumber()}`;break;case"size":if(2!=e.split(",").length)throw new Error("size Attribute On stack Tag Must Have 2 Parameters");f+=`\nstack${h}.size = new Size(${e.split(",")[0].getNumber()},${e.split(",")[1].getNumber()})`;break;case"spacing":f+=`\nstack${h}.spacing = ${e.getNumber()}`;break;case"url":f+=`\nstack${h}.url = "${e.replaceQuotes()}"`;break;case"padding":let i=e.split(",").map(function(e){return e.trim().getNumber()});if(1==i.length)i=[i[0],i[0],i[0],i[0]];else if(2==i.length)i=[i[0],i[1],i[0],i[1]];else if(4!=i.length)throw new Error("padding Attribute On stack Must Have 1, 2 Or 4 Parameters");f+=`\nwidget.setPadding(${i.join(",")})`;break;case"bottom-align-content":f+=`\nstack${h}.bottomAlignContent()`;break;case"center-align-content":f+=`\nstack${h}.centerAlignContent()`;break;case"top-align-content":f+=`\nstack${h}.topAlignContent()`;break;case"layout-horizontally":f+=`\nstack${h}.layoutHorizontally()`;break;case"layout-vertically":f+=`\nstack${h}.layoutVertically()`;break;default:throw new Error(`Unknown Attribute ${r} On Tag ${t.tagName}`)}}for(var n of t.children)$="stack"+h,e(n);return}"symbol"==t.tagName&&(a=`SFSymbol.named("${t.attributes.named?t.attributes.named:"questionmark.circle"}").image`);if("img"==t.tagName||"symbol"==t.tagName){if(w++,a)f+=`\nlet image${w} = ${$}.addImage(${a})`;else{if(!t.attributes.src)throw new Error("image Element Must Have A src Attribute");if(t.attributes.src.trim().startsWith("data:image/")){let e=t.attributes.src.trim();e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),f+=`\nlet image${w} = ${$}.addImage(Image.fromData(Data.fromBase64String("${e.replaceQuotes()}")))`}else f+=`\nlet image${w} = ${$}.addImage(await new Request("${t.attributes.src.replaceQuotes()}").loadImage())`}for(var r of Object.keys(t.attributes)){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":1!=e.split(",").length?f+=`\nstack${h}.backgroundColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nstack${h}.backgroundColor = new Color("${e.replaceQuotes()}")`;break;case"border-color":1!=e.split(",").length?f+=`\nimage${w}.borderColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nimage${w}.borderColor = new Color("${e.replaceQuotes()}")`;break;case"border-width":f+=`\nimage${w}.borderWidth = ${e.getNumber()}`;break;case"container-relative-shape":f+=`\nimage${w}.containerRelativeShape = true`;break;case"corner-radius":f+=`\nimage${w}.cornerRadius = ${e.getNumber()}`;break;case"image-opacity":(e=e.match(/\d*(?:\.\d*)?%?/)[0]).endsWith("%")&&(e=Number(e.replace("%","")),e/=100),f+=`\nimage${w}.imageOpacity = ${e}`;break;case"image-size":if(2!=e.split(",").length)throw new Error("image-size Attribute On image Tag Must Have 2 Parameters");f+=`\nimage${w}.imageSize = new Size(${e.split(",")[0].getNumber()},${e.split(",")[1].getNumber()})`;break;case"resizable":f+=`\nimage${w}.resizable = false`;break;case"tint-color":1!=e.split(",").length?f+=`\nimage${w}.tintColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\nimage${w}.tintColor = new Color("${e.replaceQuotes()}")`;break;case"url":f+=`\nimage${w}.url = "${e.replaceQuotes()}"`;break;case"apply-filling-content-mode":f+=`\nimage${w}.applyFillingContentMode()`;break;case"apply-fitting-content-mode":f+=`\nimage${w}.applyFittingContentMode()`;break;case"center-align-image":f+=`\nimage${w}.centerAlignImage()`;break;case"left-align-image":f+=`\nimage${w}.leftAlignImage()`;break;case"right-align-image":f+=`\nimage${w}.rightAlignImage()`;break;case"named":case"src":break;default:throw new Error(`Unknown Attribute ${r} On Tag ${t.tagName}`)}}return}if("text"==t.tagName){k++;let e=[];for(var n of t.children)"Text"==n.type&&/[^\s]/.test(n.content)&&e.push(n.content);for(var r of(f+=`\nlet text${k} = ${$}.addText("${e.join(" ").replaceQuotes().replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&")}")`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"font":if(2!=e.split(",").length)throw new Error("font Attribute On text Tag Must Have 2 Parameters");f+=`\ntext${k}.font = new Font("${e.split(",")[0].trim().replaceQuotes()}",${e.split(",")[1].trim().getNumber()})`;break;case"line-limit":f+=`\ntext${k}.lineLimit = ${e.getNumber()}`;break;case"minimum-scale-factor":(e=e.match(/\d*(?:\.\d*)?%?/)[0]).endsWith("%")&&(e=Number(e.replace("%","")),e/=100),f+=`\ntext${k}.minimumScaleFactor = ${e}`;break;case"shadow-color":1!=e.split(",").length?f+=`\ntext${k}.shadowColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\ntext${k}.shadowColor = new Color("${e.replaceQuotes()}")`;break;case"shadow-offset":if(2!=e.split(",").length)throw new Error("shadow-offset Attribute On text Tag Must Have 2 Parameters");f+=`\ntext${k}.shadowOffset = new Point(${e.split(",")[0].trim().match(/-?\d*/)[0]},${e.split(",")[1].trim().match(/-?\d*/)[0]})`;break;case"shadow-radius":f+=`\ntext${k}.shadowRadius = ${e.getNumber()}`;break;case"text-color":1!=e.split(",").length?f+=`\ntext${k}.textColor = Color.dynamic(new Color("${e.split(",")[0].trim().replaceQuotes()}"),new Color("${e.split(",")[1].trim().replaceQuotes()}"))`:f+=`\ntext${k}.textColor = new Color("${e.replaceQuotes()}")`;break;case"text-opacity":(e=e.match(/\d*(?:\.\d*)?%?/)[0]).endsWith("%")&&(e=Number(e.replace("%","")),e/=100),f+=`\ntext${k}.textOpacity = ${e}`;break;case"url":f+=`\ntext${k}.url = ${e.replaceQuotes}`;break;case"center-align-text":f+=`\ntext${k}.centerAlignText()`;break;case"left-align-text":f+=`\ntext${k}.leftAlignText()`;break;case"right-align-text":f+=`\ntext${k}.rightAlignText()`;break;default:throw new Error(`Unknown Attribute ${r} On Tag ${t.tagName}`)}}return}if("spacer"==t.tagName)return void(f+=`\n${$}.addSpacer(${/\d+/.exec(t.attributes.space)?/\d+/.exec(t.attributes.space):""})`);throw"widget"==t.tagName?new Error("widget Tags Must Not Be Nestled"):new Error("Invalid Tag Name:"+t.tagName)}((y=e,function(e){let t={tag:"root",children:[]},a=[t];a.last=(()=>a[a.length-1]);for(let t=0;t<e.length;t++){const r=e[t];if(r instanceof c){const e=b(d,r);e.children?a.push(e):a.last().children.push(e)}else if(r instanceof u){let e=a[a.length-2],t=a.pop();e.children.push(t)}else r instanceof m&&a.last().children.push(b(p,r))}return t}(function(e){let t=e,n=[];const i=Date.now()+1e3;for(;t;){if(0===t.indexOf("\x3c!--")){const e=t.indexOf("--\x3e")+3;t=t.substring(e);continue}if(0===t.indexOf("</")){const e=t.match(r);if(!e)continue;t=t.substring(e[0].length);const a=e[1];if(l(a))continue;n.push(new u(a));continue}if(0===t.indexOf("<")){const e=t.match(a);if(!e)continue;t=t.substring(e[0].length);const r=e[1],i=e[2],o=l(r)?new g(r,i):new c(r,i);n.push(o);continue}const e=t.indexOf("<"),o=e<0?t:t.substring(0,e);if(t=e<0?"":t.substring(e),n.push(new m(o)),Date.now()>=i)break}return n}(y))).children.filter(e=>{if("widget"==e.tagName)return e})[0]),1==t&&console.log(f);let x=new(0,Object.getPrototypeOf(async function(){}).constructor)(f+"\nreturn widget");return await x()}
