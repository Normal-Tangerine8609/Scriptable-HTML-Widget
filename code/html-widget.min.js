async function htmlWidget(e,t){const a=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,n=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function i(e){return e.split(",").reduce((e,t)=>(e[t]=!0,e),{})}const s=i("symbol,img,spacer"),o=i("bottom-align-content,center-align-content,top-align-content,layout-vertically,layout-horizontally,container-relative-shape,resizable,apply-filling-content-mode,apply-fitting-content-mode,center-align-image,left-align-image,right-align-image,center-align-text,left-align-text,right-align-text");function c(e){return!!s[e]}class g{constructor(e,t){this.name=e,this.attributes=this.getAttributes(t)}getAttributes(e){let t={};return e.replace(n,function(e,a){const r=Array.prototype.slice.call(arguments),n=r[2]?r[2]:r[3]?r[3]:r[4]?r[4]:function(e){return!!o[e]}(a)?a:"";t[a]=n.replace(/(^|[^\\])"/g,'$1\\"')}),t}}class l extends g{constructor(e,t){super(e,t)}}class d{constructor(e){this.name=e}}class u{constructor(e){this.text=e}}const m="Element",f="Text";function b(e,t){switch(e){case m:return function(e){const t=e.name,a=e.attributes;return e instanceof l?{type:m,tagName:t,attributes:a}:{type:m,tagName:t,attributes:a,children:[]}}(t);case f:return function(e){const t=e.text;return{type:f,content:t}}(t)}}let p,$,w=-1,h=-1,k=-1,A=-1;var y;!function e(t){let a;if(!t)throw new Error("widget Tag Must Be The Parent Tag");if("Text"==t.type)return;if("widget"==t.tagName&&!$){for(var r of($="let widget = new ListWidget()",Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":E("widget","background-color",e,"widget");break;case"background-gradient":v("widget",e,"widget");break;case"background-image":N(e,"widget");break;case"refresh-after-date":case"spacing":O("widget",r,e,"widget");break;case"url":$+=`\nwidget.url = "${e.replace(/"/g,"")}"`;break;case"padding":I("widget",e,"widget");break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}for(var n of t.children)p="widget",e(n);return}if("stack"==t.tagName){for(var r of($+=`\nlet stack${++w} = ${p}.addStack()`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"background-color":E("stack",r,e,"stack"+w);break;case"background-gradient":v("stack",e,"stack"+w);break;case"background-image":N(e,"widget");break;case"border-color":E("stack",r,e,"stack"+w);break;case"border-width":case"corner-radius":O("stack",r,e,"stack"+w);break;case"size":z("stack",r,e,"stack"+w);break;case"spacing":O("stack",r,e,"stack"+w);break;case"url":$+=`\nstack${w}.url = "${e.replace(/"/g,"")}"`;break;case"padding":I("stack",e,"stack"+w);break;case"bottom-align-content":$+=`\nstack${w}.bottomAlignContent()`;break;case"center-align-content":$+=`\nstack${w}.centerAlignContent()`;break;case"top-align-content":$+=`\nstack${w}.topAlignContent()`;break;case"layout-horizontally":$+=`\nstack${w}.layoutHorizontally()`;break;case"layout-vertically":$+=`\nstack${w}.layoutVertically()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}for(var n of t.children)p="stack"+w,e(n);return}"symbol"==t.tagName&&(a=`SFSymbol.named("${t.attributes.named?t.attributes.named:"questionmark.circle"}").image`);if("img"==t.tagName||"symbol"==t.tagName){if(h++,a)$+=`\nlet image${h} = ${p}.addImage(${a})`;else{if(!t.attributes.src)throw new Error("img Element Must Have A src Attribute");if(t.attributes.src.trim().startsWith("data:image/")){let e=t.attributes.src.trim();e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),$+=`\nlet image${h} = ${p}.addImage(Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}")))`}else $+=`\nlet image${h} = ${p}.addImage(await new Request("${t.attributes.src.replace(/"/g,"")}").loadImage())`}for(var r of Object.keys(t.attributes)){let e=t.attributes[r].trim();if(e)switch(r){case"border-color":E("img",r,e,"image"+h);break;case"border-width":O("img",r,e,"image"+h);break;case"container-relative-shape":$+=`\nimage${h}.containerRelativeShape = true`;break;case"corner-radius":O("img",r,e,"image"+h);break;case"image-opacity":C("text",r,e,"text"+k);break;case"image-size":z("img",r,e,"image"+h);break;case"resizable":$+=`\nimage${h}.resizable = false`;break;case"tint-color":E("img",r,e,"image"+h);break;case"url":$+=`\nimage${h}.url = "${e.replace(/"/g,"")}"`;break;case"apply-filling-content-mode":$+=`\nimage${h}.applyFillingContentMode()`;break;case"apply-fitting-content-mode":$+=`\nimage${h}.applyFittingContentMode()`;break;case"center-align-image":$+=`\nimage${h}.centerAlignImage()`;break;case"left-align-image":$+=`\nimage${h}.leftAlignImage()`;break;case"right-align-image":$+=`\nimage${h}.rightAlignImage()`;break;case"named":case"src":break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("text"==t.tagName){k++;let e=[];for(var n of t.children)"Text"==n.type&&/[^\s]/.test(n.content)&&e.push(n.content);for(var r of($+=`\nlet text${k} = ${p}.addText("${e.join(" ").replace(/"/g,"").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&")}")`,Object.keys(t.attributes))){let e=t.attributes[r].trim();if(e)switch(r){case"font":if(!/^\s*[^,]+,\s*\d+\s*$/.test(e))throw new Error("font Attribute On text Element Must Have 1 font And 1 Positive Integer Separated By Commas");$+=`\ntext${k}.font = new Font("${e.split(",")[0].replace(/"/g,"")}",${e.split(",")[1].match(/\d+/g)[0]})`;break;case"line-limit":O("text",r,e,"text"+k);break;case"minimum-scale-factor":C("text",r,e,"text"+k);break;case"shadow-color":E("text",r,e,"text"+k);break;case"shadow-offset":if(!/^\s*-?\d+\s*,\s*-?\d+\s*$/.test(e))throw new Error("shadow-offset Attribute On text Element Must Have 2 Integers Separated By Commas");$+=`\ntext${k}.shadowOffset = new Point(${e.split(",")[0].match(/-?\d*/)[0]},${e.split(",")[1].match(/-?\d*/)[0]})`;break;case"shadow-radius":O("text",r,e,"text"+k);break;case"text-color":E("text",r,e,"text"+k);break;case"text-opacity":C("text",r,e,"text"+k);break;case"url":$+=`\ntext${k}.url = ${e.replace(/"/g,"")}`;break;case"center-align-text":$+=`\ntext${k}.centerAlignText()`;break;case"left-align-text":$+=`\ntext${k}.leftAlignText()`;break;case"right-align-text":$+=`\ntext${k}.rightAlignText()`;break;default:throw new Error(`Unknown Attribute ${r} On ${t.tagName} Element`)}}return}if("spacer"==t.tagName)return void($+=`\n${p}.addSpacer(${/\d+/.exec(t.attributes.space)?/\d+/.exec(t.attributes.space):""})`);throw"widget"==t.tagName?new Error("widget Element Must Not Be Nestled"):new Error("Invalid Tag Name:"+t.tagName)}((y=e,function(e){let t={tag:"root",children:[]},a=[t];a.last=(()=>a[a.length-1]);for(let t=0;t<e.length;t++){const r=e[t];if(r instanceof g){const e=b(m,r);e.children?a.push(e):a.last().children.push(e)}else if(r instanceof d){let e=a[a.length-2],t=a.pop();e.children.push(t)}else r instanceof u&&a.last().children.push(b(f,r))}return t}(function(e){let t=e,n=[];const i=Date.now()+1e3;for(;t;){if(0===t.indexOf("\x3c!--")){const e=t.indexOf("--\x3e")+3;t=t.substring(e);continue}if(0===t.indexOf("</")){const e=t.match(r);if(!e)continue;t=t.substring(e[0].length);const a=e[1];if(c(a))continue;n.push(new d(a));continue}if(0===t.indexOf("<")){const e=t.match(a);if(!e)continue;t=t.substring(e[0].length);const r=e[1],i=e[2],s=c(r)?new l(r,i):new g(r,i);n.push(s);continue}const e=t.indexOf("<"),s=e<0?t:t.substring(0,e);if(t=e<0?"":t.substring(e),n.push(new u(s)),Date.now()>=i)break}return n}(y))).children.filter(e=>{if("widget"==e.tagName)return e})[0]),1==t&&console.log($);let x=new(0,Object.getPrototypeOf(async function(){}).constructor)($+"\nreturn widget");return await x();function E(e,t,a,r){if(!/^\s*#([a-fA-F0-9]{3}){1,2}(\s*,\s*#([a-fA-F0-9]{3}){1,2})?\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Be 1 Or 2 Hexes Separated By Commas`);let n=a.match(/#([a-fA-F0-9]{3}){1,2}/g);$+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${2==n.length?`Color.dynamic(new Color("${n[0]}"),new Color("${n[1]}"))`:`new Color("${n[0]}")`}`}function O(e,t,a,r){if(!/^\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer`);$+="refresh-after-date"==t?`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${/\d+/.exec(a)})\nwidget.refreshAfterDate = date`:`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${/\d+/.exec(a)}`}function C(e,t,a,r){if(!/^\s*\d*(?:\.\d*)?%?\s*$/.test(a)&&"."!==/^\s*\d*(?:\.\d*)?%?\s*$/.exec(a))throw new Error(`${t} Attribute On ${e} Element Must Be A Positive Integer Or Float With An Optional  "%" At The End`);(a=/\d*(?:\.\d*)?%?/.exec(a)[0]).endsWith("%")&&(a=Number(a.replace("%","")),a/=100),$+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = ${a}`}function v(e,t,a){if(!/(,|^)\s*\(\s*#([a-fA-F0-9]{3}){1,2}\s*,\s*#[a-fA-F0-9]{3,6}\)|(,|^)\s*#([a-fA-F0-9]{3}){1,2}/g.test(t))throw new Error(`background-gradient Attribute On ${e} Element Must Be 1 Or More Hexes Or Hexes Separated By Commas And In Brackets Separated By Commas`);let r=t.match(/(,|^)\s*\(\s*#([a-fA-F0-9]{3}){1,2}\s*,\s*#[a-fA-F0-9]{3,6}\)|(,|^)\s*#([a-fA-F0-9]{3}){1,2}/g).map(e=>e=2==(e=e.match(/#([a-fA-F0-9]{3}){1,2}/g)).length?`Color.dynamic(new Color("${e[0]}"),new Color("${e[1]}"))`:`new Color("${e[0]}")`),n=[];for(let e=0,t=r.length;e<t;e++)n.push(e/(t-1));$+=`\nlet gradient${++A} = new LinearGradient()\ngradient${A}.colors = [${r}]\ngradient${A}.locations= [${n}]\n${a}.backgroundGradient = gradient${A}`}function I(e,t,a){if(!/^\s*\d+((\s*,\s*\d+){3}|(\s*,\s*\d+))?\s*$/g.test(t))throw new Error(`padding Attribute On ${e} Element Must Be 1, 2 Or 4 Positive Integers Separated By Commas`);paddingArray=t.match(/\d+/g),1==paddingArray.length?paddingArray=[paddingArray[0],paddingArray[0],paddingArray[0],paddingArray[0]]:2==paddingArray.length&&(paddingArray=[paddingArray[0],paddingArray[1],paddingArray[0],paddingArray[1]]),$+=`\n${a}.setPadding(${paddingArray.join(",")})`}function N(e,t){e.startsWith("data:image/")?(e=e.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,",""),$+=`\n${t}.backgroundImage = Image.fromData(Data.fromBase64String("${e.replace(/"/g,"")}"))`):$+=`\n${t}.backgroundImage = await new Request("${e.replace(/"/g,"")}").loadImage()`}function z(e,t,a,r){if(!/^\s*\d+\s*,\s*\d+\s*$/.test(a))throw new Error(`${t} Attribute On ${e} Element Must Have 2 Positive Integers Separated By Commas`);$+=`\n${r}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())} = new Size(${a.match(/\d+/g)[0]},${a.match(/\d+/g)[1]})`}}
