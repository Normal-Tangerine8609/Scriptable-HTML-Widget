module.exports=async function(t,e,a){const n={colour:{add:async(t,e,a)=>{const n=e.split("-"),r=2==n.length?"Color.dynamic("+await D(n[0])+","+await D(n[1])+")":await D(n[0]);k+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())} = ${r}`},validate:()=>{}},posInt:{add:(t,e,a)=>{k+="refresh-after-date"==t?`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${/\d+/.exec(e)})\nwidget.refreshAfterDate = date`:`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())} = ${/\d+/.exec(e)}`},validate:(t,e,a)=>{/^\s*\d+\s*$/.test(a)||P(1,t,e?"attribute":"property",a)}},decimal:{add:(t,e,a)=>{(e=/\d*(?:\.\d*)?%?/.exec(e)[0]).endsWith("%")&&(e=Number(e.replace("%","")),e/=100),k+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())} = ${e}`},validate:(t,e,a)=>{let n=/^\s*(\d*(?:\.\d*)?)%?\s*$/;(!a.match(n)||a.match(n)&&["","."].includes(a.match(n)[1]))&&P(2,t,e?"attribute":"property",a)}},gradient:{add:async(t,e,a)=>{v++;let n,r=e;r=r.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).map(t=>t.trim());const l={"to left":90,"to right":270,"to top":180,"to bottom":0,"to top left":135,"to top right":225,"to bottom left":45,"to bottom right":315,"to left top":135,"to right top":225,"to left bottom":45,"to right bottom":315};n=Object.keys(l).includes(r[0])?l[r.shift()]:/\d+\s*deg/.test(r[0])?Number(r.shift().match(/(\d+)\s*deg/)[1]):0;let i=[];for(let t of r)2==(t=(t=t.replace(/\d*(\.\d+)?%?$/,"")).split("-")).length?i.push(Color.dynamic(await D(t[0]),await D(t[1]))):i.push(await D(t[0]));let o=r.map(t=>/\d*(\.\d+)?%?$/.test(t)?t.match(/\d*(\.\d+)?%?$/)[0]:null).map(t=>(t&&t.endsWith("%")&&(t=Number(t.replace("%",""))/100),!isNaN(t)&&!isNaN(parseFloat(t))||"number"==typeof t?Number(t):null));o[0]||(o[0]=0),o[o.length-1]||(o[o.length-1]=1);for(let t=0;t<o.length;t++){if(o[t]){let e=0,a=t;for(;null===o[a];)e++,a++;let n=(o[a]-o[t-1])/(e+1);for(let a=0;a<e;a++)o[a+t]=n*(a+1)+o[t-1]}}k+=`\nlet gradient${v} = new LinearGradient()\ngradient${v}.colors = [${i}]\ngradient${v}.locations = [${o}]\ngradient${v}.startPoint = ${`new Point(${1-(.5+.5*Math.cos(Math.PI*(n+90)/180))}, ${1-(.5+.5*Math.sin(Math.PI*(n+90)/180))})`}\ngradient${v}.endPoint = ${`new Point(${.5+.5*Math.cos(Math.PI*(n+90)/180)}, ${.5+.5*Math.sin(Math.PI*(n+90)/180)})`}\n${a}.backgroundGradient = gradient${v}`},validate:(t,e,a)=>{let n=a;n=n.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).map(t=>t.trim());["to left","to right","to top","to bottom","to top left","to top right","to bottom left","to bottom right","to left top","to right top","to left bottom","to right bottom"].includes(n[0])?n.shift():/\d+\s*deg/.test(n[0])&&n.shift();let r=n.map(t=>/\d*(\.\d+)?%?$/.test(t)?t.match(/\d*(\.\d+)?%?$/)[0]:null).map(t=>(t&&t.endsWith("%")&&(t=Number(t.replace("%",""))/100),!isNaN(t)&&!isNaN(parseFloat(t))||"number"==typeof t?Number(t):null));r[0]||(r[0]=0),r[r.length-1]||(r[r.length-1]=1);let l=0;for(let n=0;n<r.length;n++){let i=r[n];i&&(l>i&&P(3,t,e?"attribute":"property",a),i<0&&P(4,t,e?"attribute":"property",a),i>1&&P(5,t,e?"attribute":"property",a),l=i)}}},padding:{add:(t,e,a)=>{"default"==e?k+=`\n${a}.useDefaultPadding()`:(paddingArray=e.match(/\d+/g),1==paddingArray.length?paddingArray=[paddingArray[0],paddingArray[0],paddingArray[0],paddingArray[0]]:2==paddingArray.length&&(paddingArray=[paddingArray[0],paddingArray[1],paddingArray[0],paddingArray[1]]),k+=`\n${a}.setPadding(${paddingArray.join(",")})`)},validate:(t,e,a)=>{/^\s*\d+((\s*,\s*\d+){3}|(\s*,\s*\d+))?\s*$|^default$/g.test(a)||P(6,t,e?"attribute":"property",a)}},size:{add:(t,e,a)=>{k+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())} = new Size(${e.match(/\d+/g)[0]},${e.match(/\d+/g)[1]})`},validate:(t,e,a)=>{/^\s*\d+\s*,\s*\d+\s*$/.test(a)||P(7,t,e?"attribute":"property",a)}},font:{add:(t,e,a)=>{let n=/^\s*(((black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*(\d+))|(body|callout|caption1|caption2|footnote|subheadline|headline|largeTitle|title1|title2|title3)|((italicSystemFont)\s*,\s*(\d+)))\s*$/;n.test(e)?k+=`\n${a}.font = Font.${e.replace(n,"$3$4$6$8($5$9)")}`:k+=`\n${a}.font = new Font("${e.split(",")[0].replace(/"/g,"")}",${e.split(",")[1].match(/\d+/g)[0]})`},validate:(t,e,a)=>{/^\s*[^,]+,\s*\d+\s*$/.test(a)||["body","callout","caption1","caption2","footnote","subheadline","headline","italicSystemFont","largeTitle","title1","title2","title3"].includes(a)||P(8,t,e?"attribute":"property",a)}},point:{add:(t,e,a)=>{k+=`\n${a}.shadowOffset = new Point(${e.split(",")[0].match(/-?\d+/)[0]},${e.split(",")[1].match(/-?\d+/)[0]})`},validate:(t,e,a)=>{/^\s*-?\d+\s*,\s*-?\d+\s*$/.test(a)||P(9,t,e?"attribute":"property",a)}},bool:{add:(t,e,a)=>{"resizable"==t&&"false"!==e&&(k+=`\n${a}.resizable = false`),"container-relative-shape"==t&&"false"!==e&&(k+=`\n${a}.containerRelativeShape = true`)},validate:()=>{}},url:{add:(t,e,a)=>{k+=`\n${a}.url = "${e.replace(/"/g,"")}"`},validate:(t,e,a)=>{/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/.test(a)||P(10,t,e?"attribute":"property",a)}},image:{add:(t,e,a)=>{e.startsWith("data:image/")?k+=`\n${a}.backgroundImage = Image.fromData(Data.fromBase64String("${e.replace(/data:image\/\w+?;base64,/,"").replace(/"/g,"")}"))`:k+=`\n${a}.backgroundImage = await new Request("${e.replace(/"/g,"")}").loadImage()`},validate:(t,e,a)=>{/^(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*))|(data:image\/\w+?;base64,[a-zA-Z0-9+/]+={0,2})$/.test(a)||P(26,t,e?"attribute":"property",a)}},layout:{add:(t,e,a)=>{k+=`\n${a}.layout${"vertically"==e?"Vertically":"Horizontally"}()`},validate:(t,e,a)=>{"vertically"!=a&&"horizontally"!=a&&P(11,t,e?"attribute":"property",a)}},alignText:{add:(t,e,a)=>{k+=`\n${a}.${e}AlignText()`},validate:(t,e,a)=>{["center","left","right"].includes(a)||P(12,t,e?"attribute":"property",a)}},alignImage:{add:(t,e,a)=>{k+=`\n${a}.${e}AlignImage()`},validate:(t,e,a)=>{["center","left","right"].includes(a)||P(12,t,e?"attribute":"property",a)}},alignContent:{add:(t,e,a)=>{k+=`\n${a}.${e}AlignContent()`},validate:(t,e,a)=>{["center","top","bottom"].includes(a)||P(13,t,e?"attribute":"property",a)}},applyStyle:{add:(t,e,a)=>{k+=`\n${a}.apply${e[0].toUpperCase()+e.slice(1)}Style()`},validate:(t,e,a)=>{["date","timer","offset","relative","time"].includes(a)||P(14,t,e?"attribute":"property",a)}},contentMode:{add:(t,e,a)=>{k+=`\n${a}.apply${e[0].toUpperCase()+e.slice(1)}ContentMode()`},validate:(t,e,a)=>{["filling","fitting"].includes(a)||P(15,t,e?"attribute":"property",a)}}};let r=["img","spacer"];if(a)for(let t of Object.keys(a))"object"==typeof a[t]&&(a[t].isSelfClosing&&r.push(t),a[t]=a[t].func);const l=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,i=/^<\/([-A-Za-z0-9_]+)[^>]*>/,o=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function s(t){return t.split(",").reduce((t,e)=>(t[e]=!0,t),{})}const c=s(r.join(",")),d=s("no-css,children");function u(t){return!!c[t]}class g{constructor(t,e){this.name=t,this.attributes=this.getAttributes(e)}getAttributes(t){let e={};return t.replace(o,function(t,a){const n=Array.prototype.slice.call(arguments),r=n[2]?n[2]:n[3]?n[3]:n[4]?n[4]:function(t){return!!d[t]}(a)?a:"";e[a]=r.replace(/(^|[^\\])"/g,'$1\\"')}),e}}class p extends g{constructor(t,e){super(t,e)}}class f{constructor(t){this.name=t}}class m{constructor(t){this.text=t}}const h="Element",b="Text";function y(t,e){switch(t){case h:return function(t){const e=t.name,a=t.attributes;return t instanceof p?{type:h,tagName:e,attributes:a}:{type:h,tagName:e,attributes:a,children:[]}}(e);case b:return function(t){const e=t.text;return{type:b,content:e}}(e)}}function $(t){return function(t){let e={tag:"root",children:[]},a=[e];a.last=(()=>a[a.length-1]);for(let e=0;e<t.length;e++){const n=t[e];if(n instanceof g){const t=y(h,n);t.children?a.push(t):a.last().children.push(t)}else if(n instanceof f){let t=a[a.length-2],e=a.pop();t.children.push(e)}else n instanceof m?a.last().children.push(y(b,n)):"Comment"!=n.type||a.last().children.push(n)}return e}(function(t){let e=t,a=[];const n=Date.now()+1e3;for(;e;){if(0===e.indexOf("\x3c!--")){const t=e.indexOf("--\x3e")+3;a.push({type:"Comment",text:e.substring(4,t-3)}),e=e.substring(t);continue}if(0===e.indexOf("</")){const t=e.match(i);if(!t)continue;e=e.substring(t[0].length);const n=t[1];if(u(n))continue;a.push(new f(n));continue}if(0===e.indexOf("<")){const t=e.match(l);if(!t)continue;e=e.substring(t[0].length);const n=t[1],r=t[2],i=u(n)?new p(n,r):new g(n,r);a.push(i);continue}const t=e.indexOf("<"),r=t<0?e:e.substring(0,t);if(e=t<0?"":e.substring(t),a.push(new m(r)),Date.now()>=n)break}return a}(t))}let w,k="",x={},v=-1,N=$(t).children.filter(t=>{if("widget"==t.tagName)return t})[0];N||P(17);let I=N.children.filter(t=>"style"==t.tagName),j="";for(let t of I)for(let e of t.children)"Text"==e.type&&(j+="\n"+e.content.trim());let A=[],O=j.match(/[\s\S]+?{[\s\S]*?}/g)||[];for(let t=0;t<O.length;t++){let e=O[t];/^\s*(\.?[\w\-]+|\*)(\s*[,>]\s*(\.?[\w\-]+|\*))*\s*\{(\s*[\w\-]+\s*:\s*[^\n]+?\s*;)*?\s*([\w\-]+\s*:\s*[^\n]+\s*;?)?\s*\}/.test(e)||P(18,e.trim());let a={};e.match(/\{([\s\S]*)\}/)[1].split(";").map(t=>t.trim()).filter(t=>t).forEach(t=>{a[t.split(/:/)[0].trim()]=t.substring(t.indexOf(":")+1).trim()});let n=e.match(/(\.?[\w\-]+|\*)(\s*[>,]\s*(\.?[\w\-]+|\*))*/)[0].split(",");for(let t of n)A.push({selector:z(t.trim()),css:a})}function z(t){t=t.trim();let e=0,a=[],n=a.push({classes:[]});for(;e<t.length;){let r=t[e];if("."===r){r=t[++e];let l=/[-a-zA-Z_0-9]/;if(!l.test(r))throw new Error("A css parse error: `"+t+"`");let i="";for(;r&&l.test(r);)i+=r,r=t[++e];a[n-1].classes.push(i)}let l=/ /;if(/>/.test(r)){for(r=t[++e];r&&l.test(r);)r=t[++e];n=a.push({classes:[]})}let i=/[a-z]/i;if(i.test(r)){let l="";for(;r&&i.test(r);)l+=r,r=t[++e];a[n-1].tag=l}/\*/.test(r)&&(r=t[++e],a[n-1].tag="*"),l.test(r)&&(r=t[++e])}return a}for(let t of A)S(N,t);function S(t,e){if("Text"!=t.type&&"style"!=t.tagName&&(function t(e,a,n){if("Text"==e.type||"style"==e.tagName)return;for(let t of a.selector[n].classes){if(!e.attributes.class)return;if(!e.attributes.class.split(" ").includes(t))return}if(a.selector[n].tag&&"*"!==a.selector[n].tag&&a.selector[n].tag!==e.tagName)return;if(a.selector.length-1===n)e.css||(e.css=[]),e.css.push(a);else if(e.children)for(let r of e.children)t(r,a,n+1)}(t,e,0),t.children))for(let a of t.children)S(a,e)}await async function t(e){if("Text"==e.type||"style"==e.tagName)return;"widget"==e.tagName&&k&&P(19);x[e.tagName]||0==x[e.tagName]?x[e.tagName]++:x[e.tagName]=0;let r=x[e.tagName];let l=[];e.children=e.children||[];for(let t of e.children)"Text"==t.type&&l.push(t.content.trim());let i=l.join(" ").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&").replace(/\n\s+/g,"\\n");let o={};for(let t of Object.keys(e.attributes)){let a=e.attributes[t].trim();"class"!==t&&(o[t]=a)}let s={};if(e.css)for(let t of e.css)if(!Object.keys(e.attributes).includes("no-css"))for(let e of Object.keys(t.css))delete s[e],s[e]=t.css[e];for(let t of Object.keys(o))delete s[t],s[t]=o[t];let c,d,u;switch(e.tagName){case"spacer":return k+=`\nlet spacer${r} = ${w}.addSpacer(${o.space&&"null"!==o.space?o.space:""})`,void Z(o,s,c={space:"posInt"});case"widget":k+="let widget = new ListWidget()",Z(o,s,c={background:["gradient","image","colour"],"refresh-after-date":"posInt",spacing:"posInt",url:"url",padding:"padding"});for(let t of Object.keys(s)){let e=s[t],a="widget";if("background"==t&&"null"!==e&&"no-css"!=t&&"children"!=t)try{n.url.validate("background",!0,e),n.image.add(t,e,a)}catch(t){1===e.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length?await n.colour.add("background-color",e,a):await n.gradient.add("background-gradient",e,a)}else"null"!=e&&"children"!=t&&"no-css"!=t&&await n[c[t]].add(t,e,a)}d=k.split("\n").length;for(let a of e.children)w="widget",await t(a);for(let t=(u=k.split("\n")).length-1;t>=0&&t!=d-1;t--)u[t]="  "+u[t];return void(k=u.join("\n"));case"stack":k+=`\nlet stack${r} = ${w}.addStack()`,Z(o,s,c={background:["gradient","image","colour"],spacing:"posInt",url:"url",padding:"padding","border-color":"colour","border-width":"posInt",size:"size","corner-radius":"posInt","align-content":"alignContent",layout:"layout"});for(let t of Object.keys(s)){let e=s[t],a="stack"+r;if("background"==t&&"null"!==e&&"children"!=t&&"no-css"!=t)try{n.url.validate("background",!0,e),n.image.add(t,e,a)}catch(t){1===e.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length?await n.colour.add("background-color",e,a):await n.gradient.add("background-gradient",e,a)}else"null"!=e&&"children"!=t&&"no-css"!=t&&await n[c[t]].add(t,e,a)}d=k.split("\n").length;let l="stack"+r;for(let a of e.children)w=l,await t(a);for(let t=(u=k.split("\n")).length-1;t>=0&&t!=d-1;t--)u[t]="  "+u[t];return void(k=u.join("\n"));case"img":let g;o.src&&"null"!=o.src||P(20),g=o.src.startsWith("data:image/")?`Image.fromData(Data.fromBase64String("${o.src.replace("data:image/png;base64,","").replace("data:image/jpeg;base64,","").replace(/"/g,"")}"))`:`await new Request("${o.src.replace(/"/g,"")}").loadImage()`,k+=`\nlet img${r} = ${w}.addImage(${g})`,Z(o,s,c={src:"image",url:"url","border-color":"colour","border-width":"posInt","corner-radius":"posInt","image-size":"size","image-opacity":"decimal","tint-color":"colour",resizable:"bool","container-relative-shape":"bool","content-mode":"contentMode","align-image":"alignImage"});for(let t of Object.keys(s)){if("src"==t)continue;let e=s[t],a="img"+r;"null"!=e&&"children"!=t&&"no-css"!=t&&await n[c[t]].add(t,e,a)}return;case"text":k+=`\nlet text${r} = ${w}.addText("${i.replace(/"/g,"")}")`,Z(o,s,c={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText"});for(let t of Object.keys(s)){let e=s[t],a="text"+r;"null"!=e&&"children"!=t&&"no-css"!=t&&await n[c[t]].add(t,e,a)}return;case"date":k+=`\nlet date${r} = ${w}.addDate(new Date("${i.replace(/"/g,"")}"))`,Z(o,s,c={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText","apply-style":"applyStyle"});for(let t of Object.keys(s)){let e=s[t],a="date"+r;"null"!=e&&"children"!=t&&"no-css"!=t&&await n[c[t]].add(t,e,a)}return;default:return Object.keys(a).includes(e.tagName)||P(21,e.tagName),k+=`\n// <${e.tagName}>`,await a[e.tagName](Z,async function(a){let n=$(a);n.children=n.children.map(t=>(function t(e,a){if(e.attributes&&Object.keys(e.attributes).includes("children"))for(let t of a)e.children.push(t);e.children&&e.children.map(e=>{t(e,a)});e.attributes&&(e.attributes["no-css"]="");return e})(t,e.children));d=k.split("\n").length;for(let e of n.children){await t(e)}for(let t=(u=k.split("\n")).length-1;t>=0&&t!=d-1;t--)u[t]="  "+u[t];k=u.join("\n")},M,s,o,i),void(k+=`\n// </${e.tagName}>`)}"Comment"==e.type&&(e.text.match(/\n/g)?k+=`\n/*\n${e.text}\n*/`:k+=`\n// ${e.text}`)}(N),1==e&&console.log(k);let C=new(0,Object.getPrototypeOf(async function(){}).constructor)(k+"\nreturn widget");return await C();async function T(t){if(t.type=="Text"||t.tagName=="style"){return}if(t.tagName=="widget"&&k){P(19)}if(x[t.tagName]||x[t.tagName]==0){x[t.tagName]++}else{x[t.tagName]=0}let e=x[t.tagName];let r=[];t.children=t.children||[];for(let e of t.children){if(e.type=="Text"){r.push(e.content.trim())}}let l=r.join(" ").replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&").replace(/\n\s+/g,"\\n");let i={};for(let e of Object.keys(t.attributes)){let a=t.attributes[e].trim();if(e!=="class"){i[e]=a}}let o={};if(t.css){for(let e of t.css){if(!Object.keys(t.attributes).includes("no-css")){for(let t of Object.keys(e.css)){delete o[t];o[t]=e.css[t]}}}}for(let t of Object.keys(i)){delete o[t];o[t]=i[t]}let s,c,d;switch(t.tagName){case"spacer":k+=`\nlet spacer${e} = ${w}.addSpacer(${i.space&&i.space!=="null"?i.space:""})`;s={space:"posInt"};Z(i,o,s);return;break;case"widget":k+=`let widget = new ListWidget()`;s={background:["gradient","image","colour"],"refresh-after-date":"posInt",spacing:"posInt",url:"url",padding:"padding"};Z(i,o,s);for(let t of Object.keys(o)){let e=o[t];let a="widget";if(t=="background"&&e!=="null"&&t!="no-css"&&t!="children"){try{n.url.validate("background",true,e);n.image.add(t,e,a)}catch(t){if(e.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length===1){await n.colour.add("background-color",e,a)}else{await n.gradient.add("background-gradient",e,a)}}}else if(e!="null"&&t!="children"&&t!="no-css"){await n[s[t]].add(t,e,a)}}c=k.split("\n").length;for(let e of t["children"]){w="widget";await T(e)}d=k.split("\n");for(let t=d.length-1;t>=0;t--){if(t==c-1){break}d[t]="  "+d[t]}k=d.join("\n");return;break;case"stack":k+=`\nlet stack${e} = ${w}.addStack()`;s={background:["gradient","image","colour"],spacing:"posInt",url:"url",padding:"padding","border-color":"colour","border-width":"posInt",size:"size","corner-radius":"posInt","align-content":"alignContent",layout:"layout"};Z(i,o,s);for(let t of Object.keys(o)){let a=o[t];let r="stack"+e;if(t=="background"&&a!=="null"&&t!="children"&&t!="no-css"){try{n.url.validate("background",true,a);n.image.add(t,a,r)}catch(t){if(a.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length===1){await n.colour.add("background-color",a,r)}else{await n.gradient.add("background-gradient",a,r)}}}else if(a!="null"&&t!="children"&&t!="no-css"){await n[s[t]].add(t,a,r)}}c=k.split("\n").length;let r="stack"+e;for(let e of t["children"]){w=r;await T(e)}d=k.split("\n");for(let t=d.length-1;t>=0;t--){if(t==c-1){break}d[t]="  "+d[t]}k=d.join("\n");return;break;case"img":let g;if(!i["src"]||i["src"]=="null"){P(20)}if(i["src"].startsWith("data:image/")){g=`Image.fromData(Data.fromBase64String("${i["src"].replace("data:image/png;base64,","").replace("data:image/jpeg;base64,","").replace(/"/g,"")}"))`}else{g=`await new Request("${i["src"].replace(/"/g,"")}").loadImage()`}k+=`\nlet img${e} = ${w}.addImage(${g})`;s={src:"image",url:"url","border-color":"colour","border-width":"posInt","corner-radius":"posInt","image-size":"size","image-opacity":"decimal","tint-color":"colour",resizable:"bool","container-relative-shape":"bool","content-mode":"contentMode","align-image":"alignImage"};Z(i,o,s);for(let t of Object.keys(o)){if(t=="src"){continue}let a=o[t];let r="img"+e;if(a!="null"&&t!="children"&&t!="no-css"){await n[s[t]].add(t,a,r)}}return;break;case"text":k+=`\nlet text${e} = ${w}.addText("${l.replace(/"/g,"")}")`;s={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText"};Z(i,o,s);for(let t of Object.keys(o)){let a=o[t];let r="text"+e;if(a!="null"&&t!="children"&&t!="no-css"){await n[s[t]].add(t,a,r)}}return;break;case"date":k+=`\nlet date${e} = ${w}.addDate(new Date("${l.replace(/"/g,"")}"))`;s={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText","apply-style":"applyStyle"};Z(i,o,s);for(let t of Object.keys(o)){let a=o[t];let r="date"+e;if(a!="null"&&t!="children"&&t!="no-css"){await n[s[t]].add(t,a,r)}}return;break;default:if(!Object.keys(a).includes(t["tagName"])){P(21,t["tagName"])}k+=`\n// <${t.tagName}>`;await a[t["tagName"]](Z,u,M,o,i,l);k+=`\n// </${t.tagName}>`;return;async function u(e){let a=$(e);a.children=a.children.map(e=>r(e,t.children));let n=w;c=k.split("\n").length;for(let t of a.children){let e=n;await T(t)}for(let t=(d=k.split("\n")).length-1;t>=0;t--){if(t==c-1){break}d[t]="  "+d[t]}function r(t,e){if(t.attributes&&Object.keys(t.attributes).includes("children")){for(let a of e){t.children.push(a)}}if(t.children){t.children.map(t=>{r(t,e)})}if(t.attributes){t.attributes["no-css"]=""}return t}k=d.join("\n")}}if(t["type"]=="Comment"){if(!t["text"].match(/\n/g)){k+=`\n// ${t["text"]}`}else{k+=`\n/*\n${t["text"]}\n*/`}}}function Z(t,e,a){for(let e of Object.keys(t))if("null"!=t[e]&&"children"!=e&&"no-css"!=e)if(a[e]||P(22,e),"string"==typeof a[e])n[a[e]].validate(e,!0,t[e]);else{let r=!1;for(let l of a[e])try{n[l].validate(e,!0,t[e]),r=!0}catch(t){}!1===r&&P(23,e,a[e].join(", ").replace(/,([^,]*?)$/," or$1"),t[e])}for(let t of Object.keys(e))if("null"!=e[t]&&"children"!=t&&"no-css"!=t)if(a[t])if("string"==typeof a[t])n[a[t]].validate(t,!1,e[t]);else{let r=!1;for(let l of a[t])try{n[l].validate(t,!1,e[t]),r=!0}catch(t){}!1===r&&P(24,attr,a[t].join(", ").replace(/,([^,]*?)$/," or$1"),e[t])}else delete e[t]}function M(t,e){for(let a of Object.keys(e))Object.keys(t).includes(a)||(t[a]="null");return t}async function D(t){let e=new WebView;return await e.loadHTML(`<div id="div"style="color:${t}"></div>`),function(t,e,a,n){t=t.toString(16),e=e.toString(16),a=a.toString(16),1==t.length&&(t="0"+t);1==e.length&&(e="0"+e);1==a.length&&(a="0"+a);n=n?1==n.length?",0"+n:","+n:"";return`new Color("${"#"+t+e+a}"${n})`}(...(await e.evaluateJavaScript('window.getComputedStyle(document.getElementById("div")).color')).match(/\d+(\.\d+)?/g).map(t=>Number(t)))}function P(t){let e={1:"`{}` {} must be a positive integer: `{}`",2:"`{}` {} must be a positive integer or float with an optional `%` at the end: `{}`",3:"`{}` {} locations must be in ascending order: `{}`",4:"`{}` {} locations must be equal or greater than `0`: `{}`",5:"`{}` {} locations must be equal or less than `1`: `{}`",6:"`{}` {} must be 1, 2 or 4 positive integers separated by commas or be `default`: `{}`",7:"`{}` {} must be 2 positive integers separated by commas: `{}`",8:"`{}` {} must be 1 font name and 1 positive integer separated by commas or be a content-based font: `{}`",9:"`{}` {} must be 2 integers separated by commas: `{}`",10:"`{}` {} must be a valid URL: `{}`",11:"`{}` {} must be `vertically` or `horizontally`: `{}`",12:"`{}` {} must be `left`, `right` or `center`: `{}`",13:"`{}` {} must be `top`, `bottom` or `center`: `{}`",15:"`{}` {} must be `date`, `timer` , `relative`, `time`, or `offset`: `{}`",16:"`{}` {} must be `filling` or `fitting`: `{}`",17:"`widget` tag must be the root tag",18:"Invalid CSS rule: `{}`",19:"`widget` tag must not be nestled",20:"`img` tag must have a `src` attribute",21:"Invalid tag name: `{}`",22:"Unknown attribute: `{}`",23:"`{}` attribute must be a {} type: `{}`",24:"`{}` property must be a {} type: `{}`",26:"`{}` {} must be a valid url or base encoded data link: `{}`"}[t],a=[...arguments];a.splice(0,1);for(let t of a)e=e.replace("{}",t);throw new Error(e)}};
