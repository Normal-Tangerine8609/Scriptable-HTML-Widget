async function(t,e,a){const n={colour:{add:async(t,e,a)=>{const n=e.split("-"),r=2==n.length?"Color.dynamic("+await w(n[0])+","+await w(n[1])+")":await w(n[0]);g+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))} = ${r}`},validate:()=>{}},posInt:{add:(t,e,a)=>{g+="refresh-after-date"==t?`\nlet date = new Date()\ndate.setMinutes(date.getMinutes() + ${/\d+/.exec(e)})\nwidget.refreshAfterDate = date`:`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))} = ${/\d+/.exec(e)}`},validate:(t,e,a)=>{/^\s*\d+\s*$/.test(a)||I(1,t,e?"attribute":"property",a)}},decimal:{add:(t,e,a)=>{(e=/\d*(?:\.\d*)?%?/.exec(e)[0]).endsWith("%")&&(e=Number(e.replace("%","")),e/=100),g+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))} = ${e}`},validate:(t,e,a)=>{let n=/^\s*(\d*(?:\.\d*)?)%?\s*$/;(!a.match(n)||a.match(n)&&["","."].includes(a.match(n)[1]))&&I(2,t,e?"attribute":"property",a)}},gradient:{add:async(t,e,a)=>{f++;let n,r=e;r=r.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).map((t=>t.trim()));const o={"to left":90,"to right":270,"to top":180,"to bottom":0,"to top left":135,"to top right":225,"to bottom left":45,"to bottom right":315,"to left top":135,"to right top":225,"to left bottom":45,"to right bottom":315};n=r[0]in o?o[r.shift()]:/\d+\s*deg/.test(r[0])?Number(r.shift().match(/(\d+)\s*deg/)[1]):0;let i=[];for(let t of r)t=t.replace(/\d*(\.\d+)?%?$/,""),t=t.split("-"),2==t.length?i.push(Color.dynamic(await w(t[0]),await w(t[1]))):i.push(await w(t[0]));let l=r.map((t=>/\d*(\.\d+)?%?$/.test(t)?t.match(/\d*(\.\d+)?%?$/)[0]:null)).map((t=>(t&&t.endsWith("%")&&(t=Number(t.replace("%",""))/100),!isNaN(t)&&!isNaN(parseFloat(t))||"number"==typeof t?Number(t):null)));l[0]||(l[0]=0),l[l.length-1]||(l[l.length-1]=1);for(let t=0;t<l.length;t++){if(l[t]){let e=0,a=t;for(;null===l[a];)e++,a++;let n=(l[a]-l[t-1])/(e+1);for(let a=0;a<e;a++)l[a+t]=n*(a+1)+l[t-1]}}g+=`\nlet gradient${f} = new LinearGradient()\ngradient${f}.colors = [${i}]\ngradient${f}.locations = [${l}]\ngradient${f}.startPoint = new Point(${1-(.5+.5*Math.cos(Math.PI*(n+90)/180))}, ${1-(.5+.5*Math.sin(Math.PI*(n+90)/180))})\ngradient${f}.endPoint = new Point(${.5+.5*Math.cos(Math.PI*(n+90)/180)}, ${.5+.5*Math.sin(Math.PI*(n+90)/180)})\n${a}.backgroundGradient = gradient${f}`},validate:(t,e,a)=>{let n=a;n=n.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).map((t=>t.trim()));(["to left","to right","to top","to bottom","to top left","to top right","to bottom left","to bottom right","to left top","to right top","to left bottom","to right bottom"].includes(n[0])||/\d+\s*deg/.test(n[0]))&&n.shift();let r=n.map((t=>/\d*(\.\d+)?%?$/.test(t)?t.match(/\d*(\.\d+)?%?$/)[0]:null)).map((t=>(t&&t.endsWith("%")&&(t=Number(t.replace("%",""))/100),!isNaN(t)&&!isNaN(parseFloat(t))||"number"==typeof t?Number(t):null)));r[0]||(r[0]=0),r[r.length-1]||(r[r.length-1]=1);let o=0;for(let n=0;n<r.length;n++){let i=r[n];i&&(o>i&&I(3,t,e?"attribute":"property",a),i<0&&I(4,t,e?"attribute":"property",a),i>1&&I(5,t,e?"attribute":"property",a),o=i)}}},padding:{add:(t,e,a)=>{if("default"==e)g+=`\n${a}.useDefaultPadding()`;else{let t=e.match(/\d+/g);1==t.length?t=[t[0],t[0],t[0],t[0]]:2==t.length&&(t=[t[0],t[1],t[0],t[1]]),g+=`\n${a}.setPadding(${t.join(",")})`}},validate:(t,e,a)=>{/^\s*\d+((\s*,\s*\d+){3}|(\s*,\s*\d+))?\s*$|^default$/g.test(a)||I(6,t,e?"attribute":"property",a)}},size:{add:(t,e,a)=>{g+=`\n${a}.${t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))} = new Size(${e.match(/\d+/g)[0]},${e.match(/\d+/g)[1]})`},validate:(t,e,a)=>{/^\s*\d+\s*,\s*\d+\s*$/.test(a)||I(7,t,e?"attribute":"property",a)}},font:{add:(t,e,a)=>{let n=/^\s*(((black|bold|medium|light|heavy|regular|semibold|thin|ultraLight)(MonospacedSystemFont|RoundedSystemFont|SystemFont)\s*,\s*(\d+))|(body|callout|caption1|caption2|footnote|subheadline|headline|largeTitle|title1|title2|title3)|((italicSystemFont)\s*,\s*(\d+)))\s*$/;n.test(e)?g+=`\n${a}.font = Font.${e.replace(n,"$3$4$6$8($5$9)")}`:g+=`\n${a}.font = new Font("${e.split(",")[0].replace(/"/g,"")}",${e.split(",")[1].match(/\d+/g)[0]})`},validate:(t,e,a)=>{/^\s*[^,]+,\s*\d+\s*$/.test(a)||["body","callout","caption1","caption2","footnote","subheadline","headline","italicSystemFont","largeTitle","title1","title2","title3"].includes(a)||I(8,t,e?"attribute":"property",a)}},point:{add:(t,e,a)=>{g+=`\n${a}.shadowOffset = new Point(${e.split(",")[0].match(/-?\d+/)[0]},${e.split(",")[1].match(/-?\d+/)[0]})`},validate:(t,e,a)=>{/^\s*-?\d+\s*,\s*-?\d+\s*$/.test(a)||I(9,t,e?"attribute":"property",a)}},bool:{add:(t,e,a)=>{"resizable"==t&&"false"!==e&&(g+=`\n${a}.resizable = false`),"container-relative-shape"==t&&"false"!==e&&(g+=`\n${a}.containerRelativeShape = true`)},validate:()=>{}},url:{add:(t,e,a)=>{g+=`\n${a}.url = "${e.replace(/"/g,"")}"`},validate:(t,e,a)=>{/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/.test(a)||I(10,t,e?"attribute":"property",a)}},image:{add:(t,e,a)=>{e.startsWith("data:image/")?g+=`\n${a}.backgroundImage = Image.fromData(Data.fromBase64String("${e.replace(/data:image\/\w+?;base64,/,"").replace(/"/g,"")}"))`:g+=`\n${a}.backgroundImage = await new Request("${e.replace(/"/g,"")}").loadImage()`},validate:(t,e,a)=>{/^(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*))|(data:image\/\w+?;base64,[a-zA-Z0-9+/]+={0,2})$/.test(a)||I(26,t,e?"attribute":"property",a)}},layout:{add:(t,e,a)=>{g+=`\n${a}.layout${"vertically"==e?"Vertically":"Horizontally"}()`},validate:(t,e,a)=>{"vertically"!=a&&"horizontally"!=a&&I(11,t,e?"attribute":"property",a)}},alignText:{add:(t,e,a)=>{g+=`\n${a}.${e}AlignText()`},validate:(t,e,a)=>{["center","left","right"].includes(a)||I(12,t,e?"attribute":"property",a)}},alignImage:{add:(t,e,a)=>{g+=`\n${a}.${e}AlignImage()`},validate:(t,e,a)=>{["center","left","right"].includes(a)||I(12,t,e?"attribute":"property",a)}},alignContent:{add:(t,e,a)=>{g+=`\n${a}.${e}AlignContent()`},validate:(t,e,a)=>{["center","top","bottom"].includes(a)||I(13,t,e?"attribute":"property",a)}},applyStyle:{add:(t,e,a)=>{g+=`\n${a}.apply${e[0].toUpperCase()+e.slice(1)}Style()`},validate:(t,e,a)=>{["date","timer","offset","relative","time"].includes(a)||I(14,t,e?"attribute":"property",a)}},contentMode:{add:(t,e,a)=>{g+=`\n${a}.apply${e[0].toUpperCase()+e.slice(1)}ContentMode()`},validate:(t,e,a)=>{["filling","fitting"].includes(a)||I(15,t,e?"attribute":"property",a)}}};function r(t){let e=new XMLParser(t),a={isRoot:!0,name:"root",children:[]},n=a,r={};return e.didStartElement=(t,e)=>{let a=Symbol("unique");r[a]=n;let o={name:t,attrs:e,innerText:"",children:[],end:a};n.children.push(o),n=o},e.foundCharacters=t=>{n.innerText+=""===n.innerText?t:" "+t},e.didEndElement=t=>{let e=n.end;delete n.end,n=r[e]},e.parseErrorOccurred=()=>{I(14)},a.isRoot||I(25,a.name),e.parse(),a}let o=r(t).children.find((t=>{if("widget"==t.name)return t}));o||I(17);const i=o.children.filter((t=>"style"==t.name));let l="";for(let t of i)l+="\n"+t.innerText;let s=[];const d=l.match(/[\s\S]+?{[\s\S]*?}/g)||[];for(let t of d){/^\s*(\.?[\w\-]+|\*)(\s*[,>]\s*(\.?[\w\-]+|\*))*\s*\{(\s*[\w\-]+\s*:\s*[^\n]+?\s*;)*?\s*([\w\-]+\s*:\s*[^\n]+\s*;?)?\s*\}/.test(t)||I(18,t.trim());let e={};const a=t.match(/\{([\s\S]*)\}/)[1].split(";");for(let t of a){if(t=t.trim(),!t)continue;const a=t.split(":")[0].trim(),n=t.split(":")[1].trim();e[a]=n}const n=t.match(/(\.?[\w\-]+|\*)(\s*[>,]\s*(\.?[\w\-]+|\*))*/)[0].split(",");for(let t of n)s.push({selector:c(t),css:e})}function c(t){t=t.trim();let e=0,a=[],n=a.push({classes:[]});for(;e<t.length;){let r=t[e];if("."===r){r=t[++e];let o=/[-a-zA-Z_0-9]/;o.test(r)||I(27,t);let i="";for(;r&&o.test(r);)i+=r,r=t[++e];a[n-1].classes.push(i)}let o=/ /;if(/>/.test(r)){for(r=t[++e];r&&o.test(r);)r=t[++e];n=a.push({classes:[]})}let i=/[a-z]/i;if(i.test(r)){let o="";for(;r&&i.test(r);)o+=r,r=t[++e];a[n-1].tag=o}/\*/.test(r)&&(r=t[++e],a[n-1].tag="*"),o.test(r)&&(r=t[++e])}return a}function u(t,e,a){if("style"!==t.name){for(let n of e.selector[a].classes){if(!t.attrs.class)return;if(!t.attrs.class.split(" ").includes(n))return}if(!e.selector[a].tag||"*"===e.selector[a].tag||e.selector[a].tag===t.name)if(e.selector.length-1===a)t.css||(t.css=[]),t.css.push(e);else if(t.children)for(let n of t.children)u(n,e,a+1)}}!function t(e){if("style"==e.name)return;for(let t of s)u(e,t,0);if(e.children)for(let a of e.children)t(a)}(o);let p,g="",m={},f=-1;await async function t(e){if("Text"==e.type||"style"==e.name)return;"widget"==e.name&&g&&I(19);g&&(g+="\n");m[e.name]||0==m[e.name]?m[e.name]++:m[e.name]=0;let o=m[e.name],i=e.innerText.replace(/&lt;/g,"<").replace(/&gt/g,">").replace(/&amp;/g,"&").replace(/\n\s+/g,"\\n"),l={};for(let f in e.attrs){let h=e.attrs[f].trim();["class","no-css","children"].includes(f)||(l[f]=h)}let s,d,c={};if(e.css)for(let w of e.css)if(!("no-css"in e.attrs))for(let S in w.css)delete c[S],c[S]=w.css[S];for(let z in l)delete c[z],c[z]=l[z];switch(e.name){case"spacer":return g+=`\nlet spacer${o} = ${p}.addSpacer(${l.space&&"null"!==l.space?l.space:""})`,s={space:"posInt"},void $(l,c,s);case"widget":g+="let widget = new ListWidget()",s={background:["gradient","image","colour"],"refresh-after-date":"posInt",spacing:"posInt",url:"url",padding:"padding"},$(l,c,s);for(let C in c){const M=c[C],N="widget";if("background"==C&&"null"!==M)try{n.url.validate("background",!0,M),n.image.add(C,M,N)}catch(T){1===M.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length?await n.colour.add("background-color",M,N):await n.gradient.add("background-gradient",M,N)}else if("null"!==M){const P=n[s[C]].add;v(P)?await P(C,M,N):P(C,M,N)}}d=g.split("\n").length;for(let Z of e.children)p="widget",await t(Z);return void y(d);case"stack":g+=`\nlet stack${o} = ${p}.addStack()`,s={background:["gradient","image","colour"],spacing:"posInt",url:"url",padding:"padding","border-color":"colour","border-width":"posInt",size:"size","corner-radius":"posInt","align-content":"alignContent",layout:"layout"},$(l,c,s);for(let F in c){const L=c[F],D="stack"+o;if("background"==F&&"null"!==L)try{n.image.validate("background",!0,L),n.image.add(F,L,D)}catch(U){1===L.split(/,(?![^(]*\))(?![^"']*["'](?:[^"']*["'][^"']*["'])*[^"']*$)/).length?await n.colour.add("background-color",L,D):await n.gradient.add("background-gradient",L,D)}else if("null"!==L){const R=n[s[F]].add;v(R)?await R(F,L,D):R(F,L,D)}}d=g.split("\n").length;let x="stack"+o;for(let W of e.children)p=x,await t(W);return void y(d);case"img":let k;l.src&&"null"!==l.src||I(20),k=l.src.startsWith("data:image/")?`Image.fromData(Data.fromBase64String("${l.src.replace(/data:image\/.*?;base64,/,"").replace(/"/g,"")}"))`:`await new Request("${l.src.replace(/"/g,"")}").loadImage()`,g+=`\nlet img${o} = ${p}.addImage(${k})`,s={src:"image",url:"url","border-color":"colour","border-width":"posInt","corner-radius":"posInt","image-size":"size","image-opacity":"decimal","tint-color":"colour",resizable:"bool","container-relative-shape":"bool","content-mode":"contentMode","align-image":"alignImage"},$(l,c,s);for(let E in c){if("src"==E)continue;const j=c[E],q="img"+o;if("null"!==j){const _=n[s[E]].add;v(_)?await _(E,j,q):_(E,j,q)}}return;case"text":g+=`\nlet text${o} = ${p}.addText("${i.replace(/"/g,"")}")`,s={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText"},$(l,c,s);for(let O in c){const B=c[O],G="text"+o;if("null"!==B){const H=n[s[O]].add;v(H)?await H(O,B,G):H(O,B,G)}}return;case"date":g+=`\nlet date${o} = ${p}.addDate(new Date("${i.replace(/"/g,"")}"))`,s={url:"url",font:"font","line-limit":"posInt","minimum-scale-factor":"decimal","shadow-color":"colour","shadow-offset":"point","shadow-radius":"posInt","text-color":"colour","text-opacity":"decimal","align-text":"alignText","apply-style":"applyStyle"},$(l,c,s);for(let V in c){const J=c[V],X="date"+o;if("null"!=J){const K=n[s[V]].add;v(K)?await K(V,J,X):K(V,J,X)}}return;default:e.name in a||I(21,e.name),g+=`\n// <${e.name}>`;const A=[$,u,b,c,l,i];return v(a[e.name])?await a[e.name](...A):a[e.name](...A),void(g+=`\n// </${e.name}>`);async function u(a){let n=r(a);n.children=n.children.map((t=>o(t,e.children)));d=g.split("\n").length;for(let e of n.children){await t(e)}g.split("\n");function o(t,e){if(t.children&&t.children.map((t=>{o(t,e)})),"children"in t.attrs)for(let a of e)t.children.push(a);return t.attrs["no-css"]="",t}y(d)}}}(o),1==e&&console.log(g);const h=new(0,Object.getPrototypeOf((async function(){})).constructor)(g+"\nreturn widget");return await h();function $(t,e,a){for(let e in t)if("null"!==t[e])if(a[e]||I(22,e),"string"==typeof a[e])n[a[e]].validate(e,!0,t[e]);else{let r=!1;for(let o of a[e])try{n[o].validate(e,!0,t[e]),r=!0}catch(t){}r||I(23,e,a[e].join(", ").replace(/,([^,]*?)$/," or$1"),t[e])}for(let t in e)if("null"!==e[t])if(a[t])if("string"==typeof a[t])n[a[t]].validate(t,!1,e[t]);else{let r=!1;for(let o of a[t])try{n[o].validate(t,!1,e[t]),r=!0}catch(t){}r||I(24,attr,a[t].join(", ").replace(/,([^,]*?)$/," or$1"),e[t])}else delete e[t]}function b(t,e){for(let a in e)a in t||(t[a]="null");return t}async function w(t){let e=new WebView;return await e.loadHTML(`<div id="div"style="color:${t}"></div>`),function(t,e,a,n){t=t.toString(16),e=e.toString(16),a=a.toString(16),1==t.length&&(t="0"+t);1==e.length&&(e="0"+e);1==a.length&&(a="0"+a);n=n?1==n.length?",0"+n:","+n:"";return`new Color("${"#"+t+e+a}"${n})`}(...(await e.evaluateJavaScript('window.getComputedStyle(document.getElementById("div")).color')).match(/\d+(\.\d+)?/g).map((t=>Number(t))))}function y(t){const e=g.split("\n");for(let a=e.length-1;a>=t;a--)e[a]=" "+e[a];g=e.join("\n")}function v(t){return"AsyncFunction"===t.constructor.name}function I(t){const e={1:"`{}` {} must be a positive integer: `{}`",2:"`{}` {} must be a positive integer or float with an optional `%` at the end: `{}`",3:"`{}` {} locations must be in ascending order: `{}`",4:"`{}` {} locations must be equal or greater than `0`: `{}`",5:"`{}` {} locations must be equal or less than `1`: `{}`",6:"`{}` {} must be 1, 2 or 4 positive integers separated by commas or be `default`: `{}`",7:"`{}` {} must be 2 positive integers separated by commas: `{}`",8:"`{}` {} must be 1 font name and 1 positive integer separated by commas or be a content-based font: `{}`",9:"`{}` {} must be 2 integers separated by commas: `{}`",10:"`{}` {} must be a valid URL: `{}`",11:"`{}` {} must be `vertically` or `horizontally`: `{}`",12:"`{}` {} must be `left`, `right` or `center`: `{}`",13:"`{}` {} must be `top`, `bottom` or `center`: `{}`",15:"`{}` {} must be `date`, `timer` , `relative`, `time`, or `offset`: `{}`",16:"`{}` {} must be `filling` or `fitting`: `{}`",17:"`widget` tag must be the root tag",18:"Invalid CSS rule: `{}`",19:"`widget` tag must not be nestled",20:"`img` tag must have a `src` attribute",21:"Invalid tag name: `{}`",22:"Unknown attribute: `{}`",23:"`{}` attribute must be a {} type: `{}`",24:"`{}` property must be a {} type: `{}`",26:"`{}` {} must be a valid url or base encoded data link: `{}`",14:"A parse error occurred, ensure your widget is formatted properly.",25:"A parse error occurred, ensure all self closing tages are closed: <{}>",27:"A css parse error occurred: `{}`"};let a=e[t],n=[...arguments];n.splice(0,1);for(let t of n)a=a.replace("{}",t);throw new Error(a)}};
